"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.startClient=exports.disconnectClient=undefined;var _callsite=require("callsite");var _callsite2=_interopRequireDefault(_callsite);var _path=require("path");var _path2=_interopRequireDefault(_path);var _snapshots=require("../../snapshots");var _snapshots2=_interopRequireDefault(_snapshots);var _client=require("../../client");var _client2=_interopRequireDefault(_client);var _logger=require("../../common/logger");var _logger2=_interopRequireDefault(_logger);var _rnComponentKey=require("../../common/rnComponentKey");var _rnComponentKey2=_interopRequireDefault(_rnComponentKey);var _snapshotTest=require("./snapshotTest");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}var client=void 0;var disconnectClient=exports.disconnectClient=function disconnectClient(){return new Promise(function(resolve){if(typeof client==='undefined'){resolve();}else{client.socket.disconnect();resolve();}});};var startClient=exports.startClient=function startClient(){return new Promise(function(resolve){client=(0,_client2.default)(7811);resolve(client);});};exports.default=function(){var withComponent=function withComponent(component,description,tests){var hashed=void 0;if(typeof client==='undefined'){_logger2.default.verbose("withComponent","starting fructose client");startClient();}try{hashed=(0,_rnComponentKey2.default)(component);}catch(err){throw new Error(err+" to test: "+description);}var testFilePath=(0,_callsite2.default)()[1].getFileName();var loadComponent=function loadComponent(){return regeneratorRuntime.async(function loadComponent$(_context){while(1){switch(_context.prev=_context.next){case 0:return _context.abrupt("return",client.loadComponent(hashed));case 1:case"end":return _context.stop();}}},null,undefined);};var snapshotTest=function snapshotTest(platform,testname){var testDir,snapsPath,snaps;return regeneratorRuntime.async(function snapshotTest$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:testDir=_path2.default.dirname(testFilePath);snapsPath=testDir+"/__snapshots__";_logger2.default.verbose("withComponent","snapshot file path is : "+snapsPath);snaps=new _snapshots2.default(platform,snapsPath);_context2.next=6;return regeneratorRuntime.awrap((0,_snapshotTest.assertSnapshot)(snaps,testname));case 6:case"end":return _context2.stop();}}},null,undefined);};var fructose={loadComponent:loadComponent,snapshotTest:snapshotTest};if(describe!==undefined){var testName=description+" \n with Component: "+component.props.fructoseID;describe(testName,function(){tests(fructose);});}else{tests(fructose);}};_logger2.default.verbose("withComponent","setting up withComponent Global");global.withComponent=withComponent;};